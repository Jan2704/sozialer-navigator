---
// src/pages/[citySlug]/[benefitSlug].astro

import Layout from '../../layouts/Layout.astro';
import SmartCalculator from '../../components/SmartCalculator.astro';

// Daten importieren
import cities from '../../data/cities_2026.json';
import benefits from '../../data/benefits.json';

// DIESE FUNKTION IST DER MOTOR:
// Sie sagt Astro: "Generiere für jede Stadt aus der cities.json 
// und für jede Leistung aus der benefits.json eine eigene Seite."
export async function getStaticPaths() {
  const paths = [];

  cities.forEach((city) => {
    // Wir gehen durch jede Leistung (wohngeld, grundsicherung)
    Object.keys(benefits).forEach((benefitKey) => {
      const benefit = benefits[benefitKey];
      
      paths.push({
        params: { 
          citySlug: city.slug,      // z.B. "berlin"
          benefitSlug: benefit.slug  // z.B. "wohngeld"
        },
        props: { 
          cityInfo: city, 
          benefitInfo: benefit 
        }
      });
    });
  });

  return paths;
}

// Hier holen wir uns die Daten für die aktuell aufgerufene Seite
const { cityInfo, benefitInfo } = Astro.props;
const { citySlug, benefitSlug } = Astro.params;

// SEO-Titel generieren
const seoTitle = `${benefitInfo.name} in ${cityInfo.stadt} | Check 2026`;
---

<Layout title={seoTitle} description={benefitInfo.description}>
  <main class="container reveal" style="padding: 80px 24px;">
    
    <nav style="margin-bottom: 40px;">
      <a href={`/${citySlug}`} style="text-decoration: none; color: var(--gray); font-weight: 700; font-size: 0.9rem;">
        ← Übersicht {cityInfo.stadt}
      </a>
    </nav>

    <header style="margin-bottom: 60px;">
      <div style="display: inline-block; background: var(--black); color: white; padding: 4px 12px; border-radius: 4px; font-size: 0.65rem; font-weight: 800; text-transform: uppercase; margin-bottom: 1rem;">
        {benefitInfo.legal_basis}
      </div>
      <h1 style="font-size: clamp(2rem, 6vw, 3.5rem); margin-bottom: 1rem;">
        {benefitInfo.name} <br/> 
        <span style="color: var(--brand);">für {cityInfo.stadt}</span>
      </h1>
      <p style="font-size: 1.2rem; color: var(--gray); max-width: 650px; line-height: 1.5;">
        {benefitInfo.long_description}
      </p>
    </header>

    <section style="margin-bottom: 80px;">
      <SmartCalculator 
        benefitSlug={benefitSlug} 
        cityInfo={cityInfo} 
        benefitInfo={benefitInfo} 
      />
    </section>

    <section style="background: var(--soft-bg); border-radius: 32px; padding: 50px;">
      <h2 style="font-size: 1.8rem; margin-bottom: 20px;">Nächster Schritt</h2>
      <p style="margin-bottom: 30px; color: #444;">
        Um Ihre Ansprüche für den Monat Januar zu sichern, müssen Sie einen Antrag bei der zuständigen Stelle in {cityInfo.stadt} stellen. Ein formloses Schreiben per E-Mail reicht zur Fristwahrung aus.
      </p>
      
      <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 25px; margin-bottom: 30px;">
        <span style="font-size: 0.7rem; font-weight: 800; color: var(--gray); text-transform: uppercase;">Zuständige Behörde:</span>
        <div style="font-size: 1.1rem; font-weight: 700; margin-top: 5px;">
          {benefitInfo.agency_type} {cityInfo.stadt}
        </div>
        <div style="color: var(--brand); font-weight: 600; margin-top: 5px;">
          {cityInfo[benefitInfo.agency_key]}
        </div>
      </div>

      <a href={`mailto:${cityInfo[benefitInfo.agency_key]}?subject=Fristwahrung ${benefitInfo.name}`} 
         class="btn-primary" 
         style="display: block; text-align: center; text-decoration: none; padding: 20px; border-radius: 12px; font-weight: 800;">
        Fristwahrende E-Mail senden
      </a>
    </section>

  </main>
</Layout>