---
// src/pages/[citySlug]/[benefitSlug]/steps.astro
import Layout from '../../../layouts/Layout.astro';
import cities from '../../../data/cities_2026.json';
import benefits from '../../../data/benefits.json';

export async function getStaticPaths() {
  const paths = [];
  cities.forEach(city => {
    Object.keys(benefits).forEach(benefitKey => {
      paths.push({
        params: { 
          citySlug: city.slug, 
          benefitSlug: benefits[benefitKey].slug 
        },
        props: { 
          cityInfo: city, 
          benefitInfo: benefits[benefitKey] 
        }
      });
    });
  });
  return paths;
}

const { cityInfo, benefitInfo } = Astro.props;
const targetEmail = cityInfo[benefitInfo.agency_key];

// Dynamisches Mail-Template
const mailSubject = encodeURIComponent(`Fristwahrung: Antrag auf ${benefitInfo.name} - ${cityInfo.stadt}`);
const mailBody = encodeURIComponent(`Sehr geehrte Damen und Herren,\n\nhiermit beantrage ich formlos ${benefitInfo.name} für den Monat Januar 2026 zur Fristwahrung gemäß ${benefitInfo.legal_basis}.\n\nName: [Ihr Name]\nAnschrift: [Ihre Adresse in ${cityInfo.stadt}]\n\nBitte bestätigen Sie mir den Eingang dieser E-Mail.\n\nMit freundlichen Grüßen`);
---

<Layout title={`Nächste Schritte: ${benefitInfo.name} in ${cityInfo.stadt}`}>
  <main class="container reveal" style="padding: 80px 24px;">
    
    <header style="margin-bottom: 60px; text-align: center;">
      <h1 style="font-size: 2.5rem; margin-bottom: 16px;">Ihr Fahrplan für {cityInfo.stadt}</h1>
      <p style="color: var(--gray); font-size: 1.1rem;">Bürokratie ist kein Hindernis mehr. Folgen Sie diesen Schritten.</p>
    </header>

    <section style="margin-bottom: 60px;">
      <div style="background: var(--black); color: white; border-radius: 32px; padding: 50px;">
        <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 30px;">
          <div style="background: var(--brand); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; flex-shrink: 0;">1</div>
          <div>
            <h2 style="color: white; margin-bottom: 8px;">Frist heute wahren</h2>
            <p style="color: #cbd5e1; font-size: 0.95rem;">Wichtig: Ein formloser Antrag per E-Mail sichert Ihren Anspruch rückwirkend für den gesamten Monat.</p>
          </div>
        </div>

        <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; margin-bottom: 30px;">
          <p style="font-size: 0.75rem; color: var(--brand); font-weight: 800; text-transform: uppercase; margin-bottom: 15px;">E-Mail Entwurf für {cityInfo.stadt}:</p>
          <pre style="white-space: pre-wrap; font-family: monospace; font-size: 0.9rem; color: #e2e8f0; line-height: 1.6;">{decodeURIComponent(mailBody)}</pre>
        </div>

        <a href={`mailto:${targetEmail}?subject=${mailSubject}&body=${mailBody}`} 
           style="background: var(--brand); color: white; display: block; text-align: center; padding: 22px; border-radius: 16px; font-weight: 800; text-decoration: none; font-size: 1.2rem;">
           E-Mail jetzt an {benefitInfo.agency_type} senden
        </a>
      </div>
    </section>

    <section style="margin-bottom: 60px;">
      <h2 style="font-size: 1.8rem; margin-bottom: 30px;">2. Diese Unterlagen vorbereiten</h2>
      <div style="display: grid; gap: 16px;">
        {["Mietvertrag & aktuelle Mietbescheinigung", "Einkommensnachweis (letzte 3 Monate)", "Personalausweis oder Reisepass", "Kontoauszüge (lückenlos)"].map(item => (
          <div style="background: white; border: 1.5px solid #e2e8f0; padding: 20px; border-radius: 16px; display: flex; align-items: center; gap: 15px;">
            <div style="width: 24px; height: 24px; border: 2px solid #cbd5e1; border-radius: 6px;"></div>
            <span style="font-weight: 600; color: #334155;">{item}</span>
          </div>
        ))}
      </div>
    </section>

    <section style="background: var(--brand-light); border: 2px solid var(--brand); padding: 40px; border-radius: 32px; text-align: center;">
      <h3 style="color: var(--brand); margin-bottom: 15px;">Brauchen Sie Hilfe beim Neustart?</h3>
      <p style="color: #1e40af; font-size: 1rem; margin-bottom: 25px; max-width: 500px; margin-left: auto; margin-right: auto;">
        Als Bezieher von Sozialleistungen haben Sie oft Anspruch auf ein <strong>kostenloses 1-zu-1 Coaching</strong> (AVGS). Wir prüfen das für Sie.
      </p>
      <a href="/avgs-check" style="background: var(--black); color: white; padding: 16px 32px; border-radius: 12px; font-weight: 800; text-decoration: none; display: inline-block;">
        Jetzt Anspruch prüfen
      </a>
    </section>

  </main>
</Layout>