---
// index.astro - Sozialer Navigator 2026 - Dynamic Hub Titles & Local SEO
import { wohngeldData } from '../data/wohngeldData.js';
---

<!DOCTYPE html>
<html lang="de" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Sozialer Navigator | Wohngeld & Bürgergeld Vorprüfung 2026</title>
    <meta name="description" content="Prüfen Sie Ihren Anspruch auf Wohngeld und Bürgergeld 2026. Inklusive Städteverzeichnis, Mietstufen-Check und Fristwahrung nach § 24 WoGG." />
    
    <!-- FAVICON (Compass Icon in Brand Blue) -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- 0.01% UPGRADE: SOCIAL MEDIA PREVIEW (OPEN GRAPH) -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Sozialer Navigator | Wohngeld & Bürgergeld Vorprüfung 2026" />
    <meta property="og:description" content="Prüfen Sie Ihren Anspruch auf Wohngeld und Bürgergeld 2026. Inklusive Städteverzeichnis, Mietstufen-Check und Fristwahrung nach § 24 WoGG." />
    <meta property="og:image" content="https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&w=1200&q=80" />
    <meta property="og:url" content="https://sozialer-navigator.de/" />
    
    <!-- Libraries -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Wer hat Anspruch auf Wohngeld?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Wohngeld steht Haushalten mit geringem Einkommen zu, die keine anderen Sozialleistungen (wie Bürgergeld) beziehen. Ob Sie anspruchsberechtigt sind, hängt von der Anzahl der Haushaltsmitglieder, dem Gesamteinkommen und der Miethöhe (bzw. Belastung bei Eigentum) ab."
          }
        },
        {
          "@type": "Question",
          "name": "Wie hoch ist der Freibetrag beim Bürgergeld?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Die ersten 100 Euro aus Erwerbseinkommen sind komplett anrechnungsfrei (Grundfreibetrag). Für Einkommen zwischen 100 Euro und 520 Euro bleiben weitere 20% anrechnungsfrei. Für Einkommen zwischen 520 Euro und 1.000 Euro sind es 30%."
          }
        },
        {
          "@type": "Question",
          "name": "Kann ich Wohngeld und Bürgergeld gleichzeitig beziehen?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Nein, das ist grundsätzlich ausgeschlossen. Wohngeld ist eine vorrangige Leistung. Wenn Ihr Anspruch auf Wohngeld (plus ggf. Kinderzuschlag) so hoch ist, dass Sie kein Bürgergeld mehr benötigen, müssen Sie Wohngeld beantragen."
          }
        },
        {
          "@type": "Question",
          "name": "Wie lange dauert die Bearbeitung?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Die Bearbeitungszeiten variieren je nach Stadt stark und liegen oft zwischen 3 und 12 Wochen. Wichtig: Der Anspruch gilt rückwirkend ab dem Monat der Antragstellung. Sichern Sie sich die Frist durch einen formlosen Antrag."
          }
        },
        {
          "@type": "Question",
          "name": "Steht mir ein AVGS (Vermittlungsgutschein) zu?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Wenn Sie arbeitslos gemeldet sind (ALG I oder Bürgergeld), haben Sie oft Anspruch auf einen Aktivierungs- und Vermittlungsgutschein (AVGS). Damit können Sie kostenlos an Coachings oder privaten Arbeitsvermittlungen teilnehmen."
          }
        },
        {
          "@type": "Question",
          "name": "Steht mir Kinderzuschlag zu?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Der Kinderzuschlag (bis zu 292 Euro pro Kind) ist für Eltern gedacht, die genug für sich selbst verdienen, aber deren Einkommen nicht für die ganze Familie reicht. Er wird zusätzlich zum Kindergeld gezahlt und oft zusammen mit Wohngeld beantragt."
          }
        }
      ]
    }
    </script>
    <script is:inline src="https://cdn.tailwindcss.com"></script>
    <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script is:inline src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script is:inline src="https://unpkg.com/lucide@latest"></script>

    <script is:inline>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        brand: {
                            base: '#f8fafc',
                            indigo: '#4f46e5',
                            slate: '#0f172a',
                            blue: '#2563eb',
                            border: '#e2e8f0'
                        }
                    }
                }
            }
        }
    </script>

    <style is:global>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body { 
            background-color: #f8fafc; 
            color: #0f172a; 
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .view-section { display: none; opacity: 0; }
        .view-section.active { display: block; opacity: 1; }

        .pro-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hub-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid transparent;
            font-weight: 600;
            color: #334155;
            transition: all 0.2s;
            width: 100%;
            text-align: left;
        }
        .hub-link:hover {
            background-color: #eff6ff;
            border-color: #dbeafe;
            color: #2563eb;
        }

        .chart-container { position: relative; width: 100%; max-width: 320px; height: 240px; margin: 0 auto; }

        #lead-modal {
            display: none;
            backdrop-filter: blur(8px);
            background: rgba(15, 23, 42, 0.6);
        }
        #lead-modal.active { display: flex; }
        
        .modal-step { display: none; }
        .modal-step.active { display: block; }

        #notification-toast {
            display: none;
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 300;
        }

        .result-glow {
            text-shadow: 0 0 30px rgba(37, 99, 235, 0.2);
        }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 14px;
        }
        ::-webkit-scrollbar-track {
            background: #f8fafc;
        }
        ::-webkit-scrollbar-thumb {
            background: #0f172a;
            border: 4px solid #f8fafc;
            border-radius: 8px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }
        
        html {
            scrollbar-width: thin;
            scrollbar-color: #0f172a #f8fafc;
        }
    </style>
</head>

<body class="antialiased">
    
    <!-- HEADER -->
    <nav class="fixed top-0 w-full z-50 px-6 py-5 border-b border-white/10 bg-brand-slate/95 backdrop-blur-md shadow-sm">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showView('home')" aria-label="Startseite">
                <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center text-brand-slate font-black">N</div>
                <span class="font-extrabold text-white tracking-tight text-xl">Navigator</span>
            </div>
            <div class="hidden md:flex items-center gap-10 text-[10px] font-bold uppercase tracking-widest text-slate-400">
                <button onclick="showView('home')" class="hover:text-white transition-colors">Startseite</button>
                <button onclick="showView('hub-wohngeld')" class="hover:text-white transition-colors">Wohngeld</button>
                <button onclick="showView('hub-buergergeld')" class="hover:text-white transition-colors">Bürgergeld</button>
                <button onclick="showView('about')" class="hover:text-white transition-colors">Über uns</button>
            </div>
            <button onclick="showView('home'); setTimeout(() => scrollToId('calculator'), 100)" class="bg-brand-blue text-white px-6 py-2.5 rounded-lg text-[10px] font-bold uppercase tracking-widest hover:bg-white hover:text-brand-slate transition-all shadow-md">
                Anspruch prüfen
            </button>
        </div>
    </nav>

    <main class="pt-32 pb-24 px-6">

        <!-- VIEW 1: HOME -->
        <section id="view-home" class="view-section active max-w-7xl mx-auto">
            <div class="grid lg:grid-cols-2 gap-12 items-start">
                <!-- LEFT: ABOUT / HERO -->
                <div class="space-y-10 text-left pt-4 lg:sticky lg:top-32">
                    <div class="inline-flex items-center gap-2 bg-blue-50 border border-blue-100 px-4 py-1.5 rounded-full text-[10px] font-bold uppercase text-brand-blue tracking-widest">
                        <i data-lucide="shield-check" class="w-3.5 h-3.5"></i> Autorisierte Vorprüfung 2026
                    </div>
                    
                    <h1 class="text-5xl md:text-7xl font-black text-brand-slate tracking-tighter leading-none italic">
                        Der Kompass <br/> <span class="text-brand-blue not-italic">im sozialen Dschungel.</span>
                    </h1>
                    
                    <div class="space-y-6 text-slate-600 font-medium leading-relaxed text-lg">
                        <p>
                            Hinter dem Sozialen Navigator steht die Überzeugung, dass Hilfe nur dann wirkt, wenn sie auch gefunden wird. In einer Welt voller komplexer bürokratischer Hürden verliert man leicht den Überblick.
                        </p>
                        <p>
                            Wir sind eine digitale Brücke zwischen Menschen in herausfordernden Lebenslagen und den Institutionen, die Unterstützung bieten.
                        </p>
                    </div>

                    <div class="space-y-4 pt-4">
                        <h3 class="text-xs font-black uppercase tracking-widest text-brand-slate mb-4">Was uns auszeichnet</h3>
                        <ul class="space-y-3">
                            <li class="flex items-center gap-3 text-slate-600 font-medium">
                                <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-brand-blue shrink-0"><i data-lucide="check" class="w-4 h-4"></i></div>
                                <span><strong>Unabhängigkeit:</strong> Trägerübergreifend und neutral.</span>
                            </li>
                            <li class="flex items-center gap-3 text-slate-600 font-medium">
                                <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-brand-blue shrink-0"><i data-lucide="check" class="w-4 h-4"></i></div>
                                <span><strong>Einfachheit:</strong> Keine Behördensprache.</span>
                            </li>
                            <li class="flex items-center gap-3 text-slate-600 font-medium">
                                <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-brand-blue shrink-0"><i data-lucide="check" class="w-4 h-4"></i></div>
                                <span><strong>Aktualität:</strong> Datenstand 2026.</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- RIGHT: CALCULATOR -->
                <div id="calculator" class="pro-card p-8 md:p-10 shadow-2xl border-none space-y-8 bg-white relative z-10">
                    <div class="border-b border-slate-100 pb-6">
                        <h2 class="text-2xl font-black text-brand-slate italic mb-2">Anspruch prüfen</h2>
                        <p class="text-sm leading-relaxed text-slate-600 font-medium">
                            <strong class="text-brand-blue">Unser Service:</strong> Wir prüfen Ihren Anspruch basierend auf den lokalen Mietobergrenzen für <span class="city-name-display text-brand-blue">Ihre Stadt</span>.
                        </p>
                    </div>
                    <form id="main-calc" class="space-y-6">
                        <div class="space-y-3 relative text-left">
                            <!-- STEP 1: SEARCH INPUT -->
                            <div id="city-search-container" class="space-y-3">
                                <label for="city-input" class="text-[10px] font-bold uppercase text-slate-400 ml-1">Wohnort (Stadtsuche)</label>
                                <div class="relative">
                                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                                    <input 
                                        type="text" 
                                        id="city-input" 
                                        placeholder="Stadt eingeben..." 
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl pl-11 pr-10 py-4 font-semibold text-brand-slate outline-none focus:ring-2 focus:ring-brand-blue/10 transition-all" 
                                        autocomplete="off"
                                    >
                                    <button type="button" id="clear-city-input" class="hidden absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-brand-slate transition-colors">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <div id="city-suggestions" class="hidden absolute top-full left-0 right-0 bg-white border border-slate-200 rounded-xl shadow-2xl z-50 mt-2 max-h-56 overflow-y-auto"></div>
                            </div>

                            <!-- STEP 2: CITY CONTEXT INFO -->
                            <div id="city-info-container" class="hidden relative overflow-hidden rounded-2xl border border-blue-100 bg-gradient-to-br from-blue-50/50 to-white p-6 shadow-sm transition-all">
                                <div class="relative z-10 flex items-start justify-between">
                                    <div class="space-y-1">
                                        <div class="flex items-center gap-2">
                                            <div class="flex h-6 w-6 items-center justify-center rounded-full bg-blue-100 text-brand-blue">
                                                <i data-lucide="check" class="h-3.5 w-3.5"></i>
                                            </div>
                                            <h3 class="text-lg font-bold text-brand-slate">
                                                <span class="city-name-display"></span>
                                            </h3>
                                        </div>
                                        <p class="text-xs font-medium text-slate-500 pl-8">
                                            Mietstufe <span class="city-level-display font-bold text-brand-blue"></span> aktiv
                                        </p>
                                    </div>
                                    <button type="button" onclick="resetCitySearch()" class="rounded-lg px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider text-slate-400 transition-colors hover:bg-slate-100 hover:text-brand-slate">
                                        Ändern
                                    </button>
                                </div>

                                <div id="city-authority-info" class="hidden mt-4 pt-4 border-t border-blue-100/50 relative z-10">
                                    <p class="text-[10px] uppercase font-bold text-slate-400 tracking-widest mb-1">Zuständige Stelle</p>
                                    <p class="font-bold text-brand-slate text-sm" id="authority-name"></p>
                                    <p class="text-xs text-slate-500" id="authority-address"></p>
                                    <a id="authority-email" href="#" class="hidden mt-2 text-xs font-medium text-brand-blue hover:text-brand-slate transition-colors flex items-center gap-2">
                                        <i data-lucide="mail" class="w-3 h-3"></i>
                                        <span id="authority-email-text"></span>
                                    </a>
                                </div>

                                <div class="absolute -bottom-6 -right-6 z-0 opacity-5">
                                    <i data-lucide="map" class="h-32 w-32 rotate-12 text-brand-blue"></i>
                                </div>
                            </div>

                            <input type="hidden" id="selected-mietstufe" value="4">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-3 text-left">
                                <label for="persons" class="text-[10px] font-bold uppercase text-slate-400 ml-1 italic">Haushalt</label>
                                <select id="persons" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-4 font-semibold outline-none focus:border-brand-blue">
                                    <option value="1">1 Person</option>
                                    <option value="2">2 Personen</option>
                                    <option value="3">3 Personen</option>
                                    <option value="4">4+ Personen</option>
                                </select>
                            </div>
                            <div class="space-y-3 text-left">
                                <label for="kids" class="text-[10px] font-bold uppercase text-slate-400 ml-1 italic">Kinder</label>
                                <select id="kids" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-4 font-semibold outline-none focus:border-brand-blue">
                                    <option value="0">Keine</option>
                                    <option value="1">1 Kind</option>
                                    <option value="2">2 Kinder</option>
                                    <option value="3">3+ Kinder</option>
                                </select>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <label for="income" class="text-[10px] font-bold uppercase text-slate-400 ml-1 italic">Netto-Einkommen</label>
                            <div class="relative">
                                <input type="number" inputmode="numeric" pattern="[0-9]*" id="income" placeholder="z.B. 1850" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-5 py-4 font-bold outline-none focus:ring-2 focus:ring-brand-blue/10 transition-all">
                                <span class="absolute right-5 top-1/2 -translate-y-1/2 font-bold text-slate-300">€</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <label for="rent" class="text-[10px] font-bold uppercase text-slate-400 ml-1 italic">Warmmiete</label>
                            <div class="relative">
                                <input type="number" inputmode="numeric" pattern="[0-9]*" id="rent" placeholder="z.B. 890" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-5 py-4 font-bold outline-none focus:ring-2 focus:ring-brand-blue/10 transition-all">
                                <span class="absolute right-5 top-1/2 -translate-y-1/2 font-bold text-slate-300">€</span>
                            </div>
                        </div>
                        <button type="submit" class="w-full py-5 bg-brand-blue text-white rounded-xl font-bold uppercase tracking-widest hover:bg-brand-slate transition-all shadow-lg active:scale-[0.98]">
                            Analyse abschließen
                        </button>
                    </form>
                </div>
            </div>

            <!-- FAQ SECTION -->
            <div class="max-w-3xl mx-auto space-y-8 text-left pt-24">
                <h3 class="text-3xl font-black text-brand-slate tracking-tight italic text-center">Häufige Fragen (FAQ)</h3>
                <div class="space-y-4">
                    <details class="group bg-white border border-slate-200 rounded-2xl open:ring-2 open:ring-brand-blue/10 transition-all">
                        <summary class="flex items-center justify-between p-6 cursor-pointer list-none font-bold text-brand-slate">
                            <span>Wer hat Anspruch auf Wohngeld?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="px-6 pb-6 text-slate-600 leading-relaxed text-sm">
                            Wohngeld steht Haushalten mit geringem Einkommen zu, die keine anderen Sozialleistungen (wie Bürgergeld) beziehen. Ob Sie anspruchsberechtigt sind, hängt von der Anzahl der Haushaltsmitglieder, dem Gesamteinkommen und der Miethöhe (bzw. Belastung bei Eigentum) ab.
                        </div>
                    </details>

                    <details class="group bg-white border border-slate-200 rounded-2xl open:ring-2 open:ring-brand-blue/10 transition-all">
                        <summary class="flex items-center justify-between p-6 cursor-pointer list-none font-bold text-brand-slate">
                            <span>Wie hoch ist der Freibetrag beim Bürgergeld?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="px-6 pb-6 text-slate-600 leading-relaxed text-sm">
                            Die ersten 100 Euro aus Erwerbseinkommen sind komplett anrechnungsfrei (Grundfreibetrag). Für Einkommen zwischen 100 Euro und 520 Euro bleiben weitere 20% anrechnungsfrei. Für Einkommen zwischen 520 Euro und 1.000 Euro sind es 30%.
                        </div>
                    </details>

                    <details class="group bg-white border border-slate-200 rounded-2xl open:ring-2 open:ring-brand-blue/10 transition-all">
                        <summary class="flex items-center justify-between p-6 cursor-pointer list-none font-bold text-brand-slate">
                            <span>Kann ich Wohngeld und Bürgergeld gleichzeitig beziehen?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="px-6 pb-6 text-slate-600 leading-relaxed text-sm">
                            Nein, das ist grundsätzlich ausgeschlossen. Wohngeld ist eine vorrangige Leistung. Wenn Ihr Anspruch auf Wohngeld (plus ggf. Kinderzuschlag) so hoch ist, dass Sie kein Bürgergeld mehr benötigen, müssen Sie Wohngeld beantragen.
                        </div>
                    </details>

                    <details class="group bg-white border border-slate-200 rounded-2xl open:ring-2 open:ring-brand-blue/10 transition-all">
                        <summary class="flex items-center justify-between p-6 cursor-pointer list-none font-bold text-brand-slate">
                            <span>Wie lange dauert die Bearbeitung?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="px-6 pb-6 text-slate-600 leading-relaxed text-sm">
                            Die Bearbeitungszeiten variieren je nach Stadt stark und liegen oft zwischen 3 und 12 Wochen. Wichtig: Der Anspruch gilt rückwirkend ab dem Monat der Antragstellung. Sichern Sie sich die Frist durch einen formlosen Antrag.
                        </div>
                    </details>

                    <details class="group bg-white border border-slate-200 rounded-2xl open:ring-2 open:ring-brand-blue/10 transition-all">
                        <summary class="flex items-center justify-between p-6 cursor-pointer list-none font-bold text-brand-slate">
                            <span>Steht mir ein AVGS (Vermittlungsgutschein) zu?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="px-6 pb-6 text-slate-600 leading-relaxed text-sm">
                            Wenn Sie arbeitslos gemeldet sind (ALG I oder Bürgergeld), haben Sie oft Anspruch auf einen Aktivierungs- und Vermittlungsgutschein (AVGS). Damit können Sie kostenlos an Coachings oder privaten Arbeitsvermittlungen teilnehmen. <a href="#" onclick="openLeadForm('avgs'); return false;" class="text-brand-blue font-medium hover:text-brand-slate transition-colors underline decoration-brand-blue/30 underline-offset-4">Jetzt Anspruch prüfen.</a>
                        </div>
                    </details>

                    <details class="group bg-white border border-slate-200 rounded-2xl open:ring-2 open:ring-brand-blue/10 transition-all">
                        <summary class="flex items-center justify-between p-6 cursor-pointer list-none font-bold text-brand-slate">
                            <span>Steht mir Kinderzuschlag zu?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="px-6 pb-6 text-slate-600 leading-relaxed text-sm">
                            Der Kinderzuschlag (bis zu 292 Euro pro Kind) ist für Eltern gedacht, die genug für sich selbst verdienen, aber deren Einkommen nicht für die ganze Familie reicht. Er wird zusätzlich zum Kindergeld gezahlt und oft zusammen mit Wohngeld beantragt. <a href="#" onclick="openLeadForm('kiz'); return false;" class="text-brand-blue font-medium hover:text-brand-slate transition-colors underline decoration-brand-blue/30 underline-offset-4">Jetzt Anspruch prüfen.</a>
                        </div>
                    </details>
                </div>
            </div>
        </section>

        <!-- VIEW: ABOUT US -->
        <section id="view-about" class="view-section max-w-5xl mx-auto space-y-16">
            <header class="text-left space-y-6">
                <button onclick="goBack()" class="text-xs font-black text-slate-400 uppercase flex items-center gap-2 hover:text-brand-blue italic"><i data-lucide="arrow-left" class="w-4 h-4"></i> Zurück</button>
                <h2 class="text-4xl md:text-6xl font-black text-brand-slate tracking-tight italic uppercase">Über uns: <br/> <span class="text-brand-blue not-italic">Der Kompass im sozialen Dschungel</span></h2>
            </header>
            
            <div class="pro-card p-0 overflow-hidden border-blue-50">
                <div class="grid md:grid-cols-2">
                    <div class="p-8 md:p-12 space-y-6 flex flex-col justify-center">
                        <h3 class="text-brand-slate font-black text-2xl italic">Unser Team für soziale Gerechtigkeit</h3>
                        <p class="text-slate-600 font-medium leading-relaxed text-lg">
                            Bürokratie darf keine Barriere für soziale Sicherheit sein. Der Soziale Navigator ist Ihre digitale Anlaufstelle, um Ansprüche auf Wohngeld und Bürgergeld schnell, anonym und verständlich zu prüfen. Wir verbinden Technologie mit sozialer Verantwortung, um Licht in den Paragrafen-Dschungel zu bringen.
                        </p>
                    </div>
                    <div class="h-64 md:h-auto bg-slate-100 relative min-h-[300px]">
                        <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?auto=format&fit=crop&w=800&q=80" alt="Unser Team für soziale Gerechtigkeit" loading="lazy" decoding="async" class="absolute inset-0 w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-700" />
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8 text-left">
                <div class="pro-card p-8 md:p-10 space-y-6 bg-white">
                    <h3 class="text-2xl font-black text-brand-slate italic underline decoration-brand-blue decoration-4 underline-offset-8">Ihr Vorteil.</h3>
                    <ul class="space-y-4 text-slate-600 font-medium">
                        <li class="flex gap-3"><i data-lucide="clock" class="w-6 h-6 text-brand-blue shrink-0"></i> <span><strong class="text-brand-slate">Zeitgewinn:</strong> Statt stundenlanger Recherche erhalten Sie eine Ersteinschätzung in unter 60 Sekunden.</span></li>
                        <li class="flex gap-3"><i data-lucide="shield-check" class="w-6 h-6 text-brand-blue shrink-0"></i> <span><strong class="text-brand-slate">Rechtssicherheit:</strong> Unsere Algorithmen basieren auf den aktuellen Gesetzesgrundlagen für 2026.</span></li>
                        <li class="flex gap-3"><i data-lucide="lock" class="w-6 h-6 text-brand-blue shrink-0"></i> <span><strong class="text-brand-slate">Diskretion:</strong> Ihre Daten gehören Ihnen. Die Prüfung erfolgt lokal in Ihrem Browser – ohne Speicherung.</span></li>
                    </ul>
                </div>
                
                <div class="pro-card p-8 md:p-10 space-y-6 bg-brand-slate text-white">
                    <h3 class="text-2xl font-black text-white italic underline decoration-brand-blue decoration-4 underline-offset-8">Unsere Mission.</h3>
                    <p class="text-slate-300 font-medium leading-relaxed">
                        Staatliche Hilfe ist oft ein Labyrinth. Wir sind der rote Faden. Wir wollen die Hürde zwischen "Recht haben" und "Recht bekommen" einreißen. Niemand sollte auf existenzsichernde Leistungen verzichten müssen, nur weil der Antrag zu kompliziert ist.
                    </p>
                    <div class="space-y-2 pt-2 border-t border-white/10">
                        <p class="text-white font-bold text-xs uppercase tracking-widest mb-3">Wir stehen für:</p>
                        <ul class="space-y-2 text-slate-300 text-sm font-medium list-disc pl-4 marker:text-brand-blue">
                            <li><strong>Waffengleichheit:</strong> Expertenwissen für jeden zugänglich machen.</li>
                            <li><strong>Würde:</strong> Antragstellung ohne Scham und Bittsteller-Gefühl.</li>
                            <li><strong>Sicherheit:</strong> Verlässliche Orientierung statt Halbwissen.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="text-center max-w-4xl mx-auto pt-4">
            <div class="text-center max-w-4xl mx-auto pt-4 space-y-8">
                <p class="text-xl md:text-2xl font-black text-brand-slate italic leading-relaxed">
                    "Der Soziale Navigator soll der Standard für soziale Orientierung werden – lokal verwurzelt, digital vernetzt und menschlich unersetzbar."
                </p>
                <a href="mailto:info@sozialer-navigator.de" class="inline-flex items-center gap-2 bg-brand-blue text-white px-8 py-4 rounded-xl font-bold uppercase tracking-widest hover:bg-brand-slate transition-all shadow-lg hover:shadow-xl hover:-translate-y-1">
                    <i data-lucide="mail" class="w-5 h-5"></i> Kontakt aufnehmen
                </a>
            </div>
        </section>

        <!-- VIEW: HUB WOHNGELD -->
        <section id="view-hub-wohngeld" class="view-section max-w-5xl mx-auto space-y-12">
            <header class="text-left space-y-4">
                <button onclick="goBack()" class="text-xs font-black text-slate-400 uppercase flex items-center gap-2 hover:text-brand-blue italic"><i data-lucide="arrow-left" class="w-4 h-4"></i> Zurück</button>
                <!-- DYNAMISCHER TITEL WOHNGELD -->
                <h2 class="text-5xl md:text-7xl font-black text-brand-slate tracking-tight italic">Wohngeld <span id="hub-wohngeld-title-dynamic" class="text-brand-blue">Verzeichnis.</span></h2>
            </header>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="pro-card p-8 md:col-span-2 space-y-8 text-left">
                    <div class="space-y-3 border-b border-slate-100 pb-6">
                        <h3 class="text-xl font-bold text-brand-slate italic">Anspruch prüfen & Antragshilfe</h3>
                        <p class="text-slate-600 leading-relaxed font-medium">Du glaubst du hast Anspruch auf Wohngeld? Wir prüfen alle Leistungen, die dir zustehen und helfen bei dem Antragsprozess. Geben Sie Ihre Stadt ein, um direkt zu Ihrem lokalen Rechner und der zuständigen Behörde zu gelangen.</p>
                    </div>
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="text" id="hub-wohngeld-search" placeholder="Wohngeldstelle suchen..." class="w-full bg-slate-50 border border-slate-200 rounded-2xl pl-12 pr-5 py-4 font-semibold outline-none focus:ring-2 focus:ring-brand-blue/10">
                    </div>
                    <div id="city-list-wohngeld" class="grid sm:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto pr-2 pb-2"></div>
                </div>
                <div class="pro-card p-8 bg-brand-slate text-white space-y-6 text-left">
                    <h4 class="text-2xl font-black italic">Wohngeld Plus 2026</h4>
                    <p class="text-slate-400 text-sm font-medium leading-relaxed">
                        Seit der Reform erhalten Haushalte deutlich mehr Unterstützung. Wichtige Neuerungen:
                    </p>
                    <ul class="space-y-3 text-sm text-slate-300 font-medium list-disc pl-4 marker:text-brand-blue">
                        <li>Dauerhafte Heizkostenkomponente integriert.</li>
                        <li>Klimakomponente für energetische Sanierung.</li>
                        <li>Höhere Einkommensgrenzen für mehr Berechtigte.</li>
                    </ul>
                    <div class="pt-4 border-t border-white/10">
                        <p class="text-xs text-slate-500 uppercase tracking-widest font-bold">Datenbasis</p>
                        <p class="text-slate-400 text-sm italic">Über 100 Städte mit individuellen Mietstufen 1-7.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: HUB BÜRGERGELD -->
        <section id="view-hub-buergergeld" class="view-section max-w-5xl mx-auto space-y-12">
            <header class="text-left space-y-4">
                <button onclick="goBack()" class="text-xs font-black text-slate-400 uppercase flex items-center gap-2 hover:text-brand-blue italic"><i data-lucide="arrow-left" class="w-4 h-4"></i> Zurück</button>
                <!-- DYNAMISCHER TITEL BÜRGERGELD -->
                <h2 class="text-5xl md:text-7xl font-black text-brand-slate tracking-tight italic">Bürgergeld <span id="hub-buergergeld-title-dynamic" class="text-brand-blue">Verzeichnis.</span></h2>
            </header>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="pro-card p-8 md:col-span-2 space-y-8 text-left">
                    <div class="space-y-3 border-b border-slate-100 pb-6">
                        <h3 class="text-xl font-bold text-brand-slate italic">Grundsicherung & Jobcenter</h3>
                        <p class="text-slate-600 leading-relaxed font-medium">Du glaubst du hast Anspruch auf Bürgergeld? Wir prüfen alle Leistungen, die dir zustehen und helfen bei dem Antragsprozess. Finden Sie hier Ihr zuständiges Jobcenter und starten Sie die Berechnung für Ihren Wohnort.</p>
                    </div>
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="text" id="hub-buergergeld-search" placeholder="Jobcenter Stadt suchen..." class="w-full bg-slate-50 border border-slate-200 rounded-2xl pl-12 pr-5 py-4 font-semibold outline-none focus:ring-2 focus:ring-brand-blue/10">
                    </div>
                    <div id="city-list-buergergeld" class="grid sm:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto pr-2 pb-2"></div>
                </div>
                <div class="pro-card p-8 bg-brand-slate text-white space-y-6 text-left">
                    <h4 class="text-2xl font-black italic">Bürgergeld statt Hartz IV</h4>
                    <p class="text-slate-400 text-sm font-medium leading-relaxed">
                        Die Grundsicherung wurde modernisiert. Das hat sich für Sie verbessert:
                    </p>
                    <ul class="space-y-3 text-sm text-slate-300 font-medium list-disc pl-4 marker:text-brand-blue">
                        <li><strong>Höhere Regelsätze:</strong> 563€ für Alleinstehende.</li>
                        <li><strong>Karenzzeit:</strong> Miete wird im 1. Jahr voll übernommen.</li>
                        <li><strong>Freibeträge:</strong> Mehr Geld vom Zuverdienst behalten.</li>
                        <li><strong>Weiterbildung:</strong> Vorrang vor Vermittlung in Aushilfsjobs.</li>
                    </ul>
                    <div class="pt-4 border-t border-white/10">
                        <p class="text-xs text-slate-500 uppercase tracking-widest font-bold">Ziel</p>
                        <p class="text-slate-400 text-sm italic">Dauerhafte Integration statt kurzfristiger Jobs.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: RESULTS -->
        <section id="view-results" class="view-section max-w-6xl mx-auto space-y-16">
            <header class="text-center space-y-4 relative">
                <h3 class="text-5xl font-black text-brand-slate tracking-tight italic uppercase text-center">Ihr Ergebnisbericht</h3>
                <button onclick="showView('home'); document.getElementById('main-calc').reset();" class="absolute right-0 top-1/2 -translate-y-1/2 hidden md:flex items-center gap-2 text-xs font-bold text-slate-400 hover:text-brand-blue transition-colors uppercase tracking-widest">
                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Neu berechnen
                </button>
                <p class="text-slate-500 font-semibold uppercase text-[10px] tracking-[0.2em] text-center">Berechnet am <span id="res-date">--</span></p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-left">
                <div class="md:col-span-3 pro-card p-12 flex flex-col justify-between bg-brand-slate text-white border-none relative overflow-hidden text-left shadow-2xl min-h-[500px]">
                    <div class="absolute top-0 right-0 p-12 opacity-5 rotate-12" aria-hidden="true"><i data-lucide="sparkles" class="w-96 h-96"></i></div>
                    <div class="relative z-10 space-y-10">
                        <div>
                            <span class="text-[10px] font-bold uppercase tracking-[0.4em] text-blue-400 italic">Geschätzter monatlicher Anspruch</span>
                            <div class="text-[7rem] md:text-[10rem] font-black tracking-tighter leading-none text-blue-400 result-glow mt-4" id="res-amount">0€</div>
                        </div>
                        <div class="max-w-2xl bg-white/95 rounded-3xl border border-slate-100 shadow-xl p-8 space-y-6">
                            <p class="text-slate-900 font-bold text-xl leading-relaxed italic">
                                Basierend auf der <span id="res-mietstufe" class="text-brand-blue">Mietstufe</span> in <span id="res-city-name" class="text-brand-blue font-black underline">Ihrer Stadt</span> besteht ein positiver Anspruch.
                            </p>
                            <div id="rent-check-result" class="mt-6 pt-6 border-t border-slate-100"></div>
                            <div id="next-steps-result" class="mt-6 pt-6 border-t border-slate-100"></div>
                        </div>
                    </div>
                </div>
                <div class="pro-card p-10 flex flex-col items-center justify-center text-center space-y-8 bg-white border-brand-border shadow-md">
                    <h4 class="font-bold text-brand-slate uppercase text-xs tracking-widest italic text-center">Mietbelastung</h4>
                    <div class="chart-container text-center"><canvas id="ratioChart"></canvas></div>
                    <div id="ratio-text" class="text-6xl font-black text-brand-blue tracking-tight text-center">0%</div>
                </div>
                <div class="col-span-full pt-12 border-t border-slate-100 space-y-8">
                    <h4 class="text-2xl font-black text-brand-slate italic uppercase">Handlungsempfehlungen & Sparpotenziale</h4>
                    <div id="result-leads" class="grid md:grid-cols-3 gap-6"></div>
                    
                    <!-- INTERAKTIVE ABFRAGE (LEAD GEN) -->
                    <div id="lead-generation-form" class="hidden mt-12 p-8 md:p-12 bg-white border border-slate-200 rounded-3xl shadow-xl relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-brand-blue/5 rounded-full -mr-16 -mt-16 blur-3xl"></div>
                        <div class="relative z-10">
                            <h4 class="text-2xl font-black text-brand-slate italic mb-2">Persönliche Bedarfsanalyse</h4>
                            <p class="text-slate-500 font-medium mb-8">Beantworten Sie 2 kurze Fragen für maßgeschneiderte Unterstützung.</p>
                            
                            <form id="lead-form-internal" class="space-y-8">
                                <!-- Frage 1 -->
                                <div class="space-y-4">
                                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Aktueller Berufs-Status?</label>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <label class="cursor-pointer group">
                                            <input type="radio" name="status" value="arbeitssuchend" class="peer sr-only">
                                            <div class="p-4 border-2 border-slate-100 rounded-xl text-center font-bold text-slate-600 peer-checked:border-brand-blue peer-checked:bg-blue-50 peer-checked:text-brand-blue transition-all group-hover:border-slate-200">
                                                Arbeitssuchend
                                            </div>
                                        </label>
                                        <label class="cursor-pointer group">
                                            <input type="radio" name="status" value="berufstaetig" class="peer sr-only">
                                            <div class="p-4 border-2 border-slate-100 rounded-xl text-center font-bold text-slate-600 peer-checked:border-brand-blue peer-checked:bg-blue-50 peer-checked:text-brand-blue transition-all group-hover:border-slate-200">
                                                Berufstätig
                                            </div>
                                        </label>
                                        <label class="cursor-pointer group">
                                            <input type="radio" name="status" value="sonstiges" class="peer sr-only">
                                            <div class="p-4 border-2 border-slate-100 rounded-xl text-center font-bold text-slate-600 peer-checked:border-brand-blue peer-checked:bg-blue-50 peer-checked:text-brand-blue transition-all group-hover:border-slate-200">
                                                Sonstiges
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Frage 2 -->
                                <div class="space-y-4">
                                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Was benötigen Sie zusätzlich?</label>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <label class="cursor-pointer group">
                                            <input type="checkbox" name="needs" value="avgs" class="peer sr-only">
                                            <div class="p-4 border-2 border-slate-100 rounded-xl text-center font-bold text-slate-600 peer-checked:border-brand-blue peer-checked:bg-blue-50 peer-checked:text-brand-blue transition-all group-hover:border-slate-200">
                                                AVGS (Coaching)
                                            </div>
                                        </label>
                                        <label class="cursor-pointer group">
                                            <input type="checkbox" name="needs" value="kiz" class="peer sr-only">
                                            <div class="p-4 border-2 border-slate-100 rounded-xl text-center font-bold text-slate-600 peer-checked:border-brand-blue peer-checked:bg-blue-50 peer-checked:text-brand-blue transition-all group-hover:border-slate-200">
                                                Kinder-Zuschuss
                                            </div>
                                        </label>
                                        <label class="cursor-pointer group">
                                            <input type="checkbox" name="needs" value="ablehnung" class="peer sr-only">
                                            <div class="p-4 border-2 border-slate-100 rounded-xl text-center font-bold text-slate-600 peer-checked:border-brand-blue peer-checked:bg-blue-50 peer-checked:text-brand-blue transition-all group-hover:border-slate-200">
                                                Hilfe bei Ablehnung
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Kontaktdaten -->
                                <div class="space-y-4 pt-4 border-t border-slate-100">
                                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Ihre Kontaktdaten</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <input type="text" id="lead-firstname" placeholder="Vorname" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-semibold outline-none focus:border-brand-blue focus:ring-2 focus:ring-brand-blue/10" required>
                                        <input type="text" id="lead-lastname" placeholder="Nachname" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-semibold outline-none focus:border-brand-blue focus:ring-2 focus:ring-brand-blue/10" required>
                                    </div>
                                    <input type="email" id="lead-email" placeholder="E-Mail Adresse" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-semibold outline-none focus:border-brand-blue focus:ring-2 focus:ring-brand-blue/10" required>
                                    <input type="tel" id="lead-phone" placeholder="Telefonnummer (optional)" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-semibold outline-none focus:border-brand-blue focus:ring-2 focus:ring-brand-blue/10">
                                </div>

                                <!-- Datenschutz Checkbox -->
                                <div class="flex items-start gap-3">
                                    <input type="checkbox" id="lead-privacy" class="mt-1 w-4 h-4 text-brand-blue border-slate-300 rounded focus:ring-brand-blue cursor-pointer">
                                    <label for="lead-privacy" class="text-xs text-slate-500 font-medium leading-relaxed cursor-pointer">
                                        Ich habe die <a href="/datenschutz" target="_blank" class="text-brand-blue underline hover:text-brand-slate">Datenschutzerklärung</a> zur Kenntnis genommen und stimme zu, dass meine Angaben zur Kontaktaufnahme und für Rückfragen dauerhaft gespeichert werden.
                                    </label>
                                </div>

                                <button type="button" onclick="submitLeadForm()" class="w-full py-5 bg-brand-slate text-white rounded-xl font-bold uppercase tracking-widest hover:bg-brand-blue transition-all shadow-lg hover:shadow-xl hover:-translate-y-1">
                                    Kostenlose Prüfung anfordern
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- NOTIFICATION -->
    <div id="notification-toast" class="bg-brand-slate text-white px-8 py-4 rounded-2xl shadow-2xl flex items-center gap-4 border border-white/10 backdrop-blur-xl">
        <i data-lucide="check-circle" class="text-brand-blue"></i>
        <span id="toast-message" class="font-bold text-sm italic">Status aktualisiert.</span>
    </div>

    <!-- FOOTER -->
    <footer class="bg-brand-slate border-t border-white/10 py-24 px-6 text-left text-white">
        <div class="max-w-7xl mx-auto grid md:grid-cols-4 gap-16 relative z-10">
            <div class="col-span-2 space-y-8 text-left">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-brand-slate font-black italic shadow-lg">N</div>
                    <span class="font-extrabold text-white tracking-tight text-2xl uppercase italic">Navigator</span>
                </div>
                <p class="max-w-sm text-sm font-medium text-slate-400 italic text-left">© 2026 Sozialer Navigator | Made in Germany</p>
            </div>
            <div class="space-y-6 text-left">
                <h6 class="text-white font-bold uppercase text-[10px] tracking-widest italic">Infrastruktur</h6>
                <ul class="grid grid-cols-1 gap-3 text-xs font-semibold text-slate-400 italic uppercase text-left">
                    <li><button onclick="showView('hub-wohngeld')" class="hover:text-white">Wohngeld</button></li>
                    <li><button onclick="showView('hub-buergergeld')" class="hover:text-white">Bürgergeld</button></li>
                    <li><button onclick="showView('about')" class="hover:text-white">Über uns</button></li>
                </ul>
            </div>
            <div class="space-y-6 text-left">
                <h6 class="text-white font-bold uppercase text-[10px] tracking-widest italic">Rechtliches</h6>
                <ul class="grid grid-cols-1 gap-3 text-xs font-semibold text-slate-400 italic uppercase text-left">
                    <li><a href="/impressum" class="hover:text-white">Impressum</a></li>
                    <li><a href="/datenschutz" class="hover:text-white">Datenschutz</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <!-- COOKIE BANNER -->
    <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-6 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] z-50 hidden flex-col md:flex-row items-center justify-between gap-6 transform translate-y-full transition-transform duration-500">
        <div class="text-sm text-slate-600 font-medium max-w-2xl">
            <p><strong>Datenschutz-Hinweis:</strong> Wir nutzen Cookies, um die Funktionalität des Rechners zu gewährleisten. Es werden keine persönlichen Daten auf unseren Servern gespeichert, solange Sie keine Anfrage absenden.</p>
        </div>
        <div class="flex gap-4 shrink-0">
            <button onclick="acceptCookies()" class="bg-brand-slate text-white px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-widest hover:bg-brand-blue transition-colors shadow-lg">
                Akzeptieren
            </button>
            <button onclick="declineCookies()" class="text-slate-400 hover:text-brand-slate text-xs font-bold uppercase tracking-widest transition-colors px-4 py-2.5">
                Ablehnen
            </button>
        </div>
    </div>

    <script is:inline define:vars={{ cityData: wohngeldData }}>
        window.cityData = cityData;
    </script>

    <script is:inline type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const SUPABASE_URL = 'https://iiimjuplyjqapvwhbozf.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlpaW1qdXBseWpxYXB2d2hib3pmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NTI4MTgsImV4cCI6MjA4MTIyODgxOH0.Ru-09I4PuFQsJC-AMcdntn9bCS2f9lOdGQoMo7fAHYs';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        const RENT_LIMITS = {
            1: [359, 436, 519, 606, 691],
            2: [403, 490, 584, 683, 789],
            3: [448, 546, 651, 762, 888],
            4: [500, 609, 725, 890, 1034],
            5: [553, 671, 808, 986, 1158],
            6: [606, 739, 880, 1086, 1269],
            7: [666, 806, 974, 1199, 1394]
        };

        const CITY_DB = window.cityData.map(c => ({
            name: c.stadt,
            mietstufe: c.mietstufe,
            amt_name: c.amt_name,
            amt_adresse: c.amt_adresse,
            amt_email: c.amt_email
        })).sort((a,b) => a.name.localeCompare(b.name));

        lucide.createIcons();
        let ratioChartInstance = null;
        let selectedCityNameGlobal = null;
        let viewHistory = [];

        // Cookie Logic
        const cookieBanner = document.getElementById('cookie-banner');
        if (!localStorage.getItem('sn_cookies_accepted')) {
            cookieBanner.classList.remove('hidden');
            setTimeout(() => cookieBanner.classList.remove('translate-y-full'), 1000);
        }

        window.acceptCookies = () => {
            localStorage.setItem('sn_cookies_accepted', 'true');
            cookieBanner.classList.add('translate-y-full');
        };
        window.declineCookies = () => {
            localStorage.setItem('sn_cookies_accepted', 'false');
            cookieBanner.classList.add('translate-y-full');
        };

        window.showToast = (msg) => {
            const toast = document.getElementById('notification-toast');
            document.getElementById('toast-message').innerText = msg;
            toast.style.display = 'flex';
            setTimeout(() => { toast.style.display = 'none'; }, 3500);
        };

        window.submitLeadForm = async () => {
            const fname = document.getElementById('lead-firstname').value;
            const lname = document.getElementById('lead-lastname').value;
            const email = document.getElementById('lead-email').value;
            const phone = document.getElementById('lead-phone').value;
            const privacy = document.getElementById('lead-privacy').checked;
            
            const status = document.querySelector('input[name="status"]:checked')?.value || 'nicht angegeben';
            const needs = Array.from(document.querySelectorAll('input[name="needs"]:checked')).map(el => el.value);

            if(!fname || !lname || !email) {
                showToast('Bitte füllen Sie alle Pflichtfelder aus.');
                return;
            }

            if(!privacy) {
                showToast('Bitte akzeptieren Sie die Datenschutzerklärung.');
                return;
            }

            const btn = document.querySelector('button[onclick="submitLeadForm()"]');
            const originalText = btn.innerText;
            btn.innerText = "Sende...";
            btn.disabled = true;

            try {
                const { error } = await supabase.from('leads').insert([{
                    first_name: fname, last_name: lname, email, phone,
                    status, needs, city: document.getElementById('city-input').value,
                    created_at: new Date().toISOString()
                }]);
                if(error) throw error;
                showToast('Anfrage erfolgreich gesendet! Ein Experte meldet sich.');
                document.getElementById('lead-form-internal').reset();
            } catch(e) {
                console.error(e);
                showToast('Fehler beim Senden. Bitte versuchen Sie es später.');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        window.openLeadForm = (type) => {
            showView('results');
            const form = document.getElementById('lead-generation-form');
            form.classList.remove('hidden');
            document.querySelectorAll('input[name="needs"]').forEach(cb => cb.checked = false);
            if (type) {
                const target = document.querySelector(`input[name="needs"][value="${type}"]`);
                if (target) target.checked = true;
            }
            setTimeout(() => scrollToId('lead-generation-form'), 100);
        };

        window.showView = (viewId, pushHistory = true) => {
            if (pushHistory) {
                const current = document.querySelector('.view-section.active');
                if (current && current.id !== 'view-' + viewId) {
                    viewHistory.push(current.id.replace('view-', ''));
                }
            }

            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            const target = document.getElementById('view-' + viewId);
            if(target) {
                target.classList.add('active');
                gsap.fromTo(target, { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.4 });
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (viewId === 'hub-wohngeld') populateHubList('wohngeld');
            if (viewId === 'hub-buergergeld') populateHubList('buergergeld');
            lucide.createIcons();
        };

        window.goBack = () => {
            const prev = viewHistory.pop();
            if (prev) showView(prev, false);
            else showView('home', false);
        };

        // Hub Such-Listener
        document.getElementById('hub-wohngeld-search').addEventListener('input', (e) => populateHubList('wohngeld', e.target.value.toLowerCase()));
        document.getElementById('hub-buergergeld-search').addEventListener('input', (e) => populateHubList('buergergeld', e.target.value.toLowerCase()));

        function populateHubList(type, filter = '') {
            const listId = type === 'wohngeld' ? 'city-list-wohngeld' : 'city-list-buergergeld';
            const list = document.getElementById(listId);
            if (!list) return;

            if (!filter) {
                list.innerHTML = `<div class="col-span-full text-center py-12 text-slate-400 italic font-medium">Bitte geben Sie eine Stadt ein, um zuständige Stellen zu finden.</div>`;
                return;
            }
            
            const filtered = CITY_DB.filter(c => c.name.toLowerCase().includes(filter))
                .sort((a, b) => {
                    const aStarts = a.name.toLowerCase().startsWith(filter);
                    const bStarts = b.name.toLowerCase().startsWith(filter);
                    if (aStarts && !bStarts) return -1;
                    if (!aStarts && bStarts) return 1;
                    return 0;
                });
            
            if (filtered.length === 0) {
                list.innerHTML = `<div class="col-span-full text-center py-12 text-slate-400 italic font-medium">Keine Ergebnisse für "${filter}" gefunden.</div>`;
                return;
            }
            
            list.innerHTML = filtered.map(city => `
                <div onclick="selectCity('${city.name}', ${city.mietstufe}); scrollToId('calculator')" 
                     class="group p-6 bg-white border border-slate-100 rounded-2xl hover:border-brand-blue/30 hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer text-left relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-3">
                            <h5 class="font-bold text-brand-slate text-lg group-hover:text-brand-blue transition-colors">${city.name}</h5>
                            <span class="text-[10px] font-black uppercase tracking-widest bg-slate-50 text-slate-400 px-2 py-1 rounded-md">Stufe ${city.mietstufe}</span>
                        </div>
                        <p class="text-xs text-slate-500 font-medium mb-4 flex items-center gap-2">
                            <i data-lucide="${type === 'wohngeld' ? 'building-2' : 'briefcase'}" class="w-3.5 h-3.5"></i>
                            ${type === 'wohngeld' ? (city.amt_name || 'Wohngeldstelle') : 'Jobcenter ' + city.name}
                        </p>
                        ${(type === 'wohngeld' && city.amt_email) ? `
                        <div class="inline-flex items-center gap-1.5 text-[10px] font-bold text-brand-blue bg-blue-50 px-2.5 py-1.5 rounded-full">
                            <i data-lucide="mail" class="w-3 h-3"></i> ${city.amt_email}
                        </div>
                        ` : ''}
                    </div>
                    <div class="absolute right-0 bottom-0 opacity-[0.03] group-hover:opacity-10 transition-opacity">
                        <i data-lucide="map-pin" class="w-32 h-32 -mr-6 -mb-6 rotate-12"></i>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // Haupt-Stadtsuche
        const cityInput = document.getElementById('city-input');
        const suggestions = document.getElementById('city-suggestions');
        const clearCityInputBtn = document.getElementById('clear-city-input');
        let currentFocus = -1;

        cityInput.addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            currentFocus = -1;
            
            if (val.length > 0) clearCityInputBtn.classList.remove('hidden');
            else clearCityInputBtn.classList.add('hidden');

            if (val.length < 2) { suggestions.classList.add('hidden'); return; }
            const matches = CITY_DB.filter(c => c.name.toLowerCase().includes(val))
                .sort((a, b) => {
                    const aStarts = a.name.toLowerCase().startsWith(val);
                    const bStarts = b.name.toLowerCase().startsWith(val);
                    if (aStarts && !bStarts) return -1;
                    if (!aStarts && bStarts) return 1;
                    return 0;
                })
                .slice(0, 5);
            if (matches.length > 0) {
                suggestions.innerHTML = matches.map(c => {
                    const regex = new RegExp(`(${val.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                    const highlighted = c.name.replace(regex, '<span class="text-brand-blue font-extrabold">$1</span>');
                    return `
                    <div role="option" class="suggestion-item group p-4 cursor-pointer border-b border-slate-50 last:border-none flex justify-between items-center transition-all duration-200 hover:bg-blue-50/50" onclick="selectCity('${c.name}', ${c.mietstufe})">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-slate-50 flex items-center justify-center text-slate-400 group-hover:bg-white group-hover:text-brand-blue group-hover:shadow-sm transition-all">
                                <i data-lucide="map-pin" class="w-4 h-4"></i>
                            </div>
                            <span class="text-sm font-medium text-slate-700 group-hover:text-slate-900 transition-colors">${highlighted}</span>
                        </div>
                        <span class="text-[10px] bg-slate-100 text-slate-400 px-2 py-1 rounded-md uppercase font-bold tracking-wider group-hover:bg-white group-hover:text-brand-blue group-hover:shadow-sm transition-all">Stufe ${c.mietstufe}</span>
                    </div>
                `}).join('');
                suggestions.classList.remove('hidden');
                lucide.createIcons();
            } else { suggestions.classList.add('hidden'); }
        });

        cityInput.addEventListener('keydown', (e) => {
            const items = suggestions.querySelectorAll('.suggestion-item');
            if (e.key === 'ArrowDown') {
                currentFocus++;
                addActive(items);
            } else if (e.key === 'ArrowUp') {
                currentFocus--;
                addActive(items);
            } else if (e.key === 'Enter') {
                if (currentFocus > -1 && items.length > 0) {
                    e.preventDefault();
                    items[currentFocus].click();
                }
            } else if (e.key === 'Escape') {
                suggestions.classList.add('hidden');
                currentFocus = -1;
            }
        });

        function addActive(items) {
            if (!items || items.length === 0) return false;
            removeActive(items);
            if (currentFocus >= items.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (items.length - 1);
            items[currentFocus].classList.add('bg-blue-50');
            items[currentFocus].scrollIntoView({ block: 'nearest' });
        }

        function removeActive(items) {
            for (let i = 0; i < items.length; i++) {
                items[i].classList.remove('bg-blue-50');
            }
        }

        clearCityInputBtn.addEventListener('click', () => {
            cityInput.value = '';
            suggestions.classList.add('hidden');
            clearCityInputBtn.classList.add('hidden');
            cityInput.focus();
            currentFocus = -1;
        });

        window.selectCity = (name, stufe) => {
            cityInput.value = name;
            selectedCityNameGlobal = name;
            document.getElementById('selected-mietstufe').value = stufe;
            suggestions.classList.add('hidden');

            // UI Wechsel: Suche ausblenden, Info anzeigen
            document.getElementById('city-search-container').classList.add('hidden');
            document.getElementById('city-info-container').classList.remove('hidden');
            document.querySelectorAll('.city-name-display').forEach(el => el.innerText = name);
            document.querySelector('.city-level-display').innerText = stufe;

            // Behörden-Info anzeigen, falls vorhanden
            const city = CITY_DB.find(c => c.name === name);
            if (city && city.amt_name) {
                document.getElementById('city-authority-info').classList.remove('hidden');
                document.getElementById('authority-name').innerText = city.amt_name;
                document.getElementById('authority-address').innerText = city.amt_adresse;

                const emailLink = document.getElementById('authority-email');
                if (city.amt_email) {
                    emailLink.classList.remove('hidden');
                    emailLink.href = "mailto:" + city.amt_email;
                    document.getElementById('authority-email-text').innerText = city.amt_email;
                } else {
                    emailLink.classList.add('hidden');
                }
            } else {
                document.getElementById('city-authority-info').classList.add('hidden');
            }

            // --- DYNAMISCHE TITEL AKTUALISIERUNG ---
            // Wohngeld Hub
            document.getElementById('hub-wohngeld-title-dynamic').innerText = name;
            // Bürgergeld Hub
            document.getElementById('hub-buergergeld-title-dynamic').innerText = name;

            if (!document.getElementById('view-home').classList.contains('active')) {
                showView('home');
                showToast(`Ort ${name} ausgewählt.`);
            }
            lucide.createIcons();
            document.getElementById('persons').focus();
        };

        window.resetCitySearch = () => {
            document.getElementById('city-search-container').classList.remove('hidden');
            document.getElementById('city-info-container').classList.add('hidden');
            cityInput.value = '';
            clearCityInputBtn.classList.add('hidden');
            cityInput.focus();
        };

        const calcForm = document.getElementById('main-calc');
        calcForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const inc = parseFloat(document.getElementById('income').value) || 0;
            const rnt = parseFloat(document.getElementById('rent').value) || 0;
            const ms = parseInt(document.getElementById('selected-mietstufe').value);
            const kidsCount = parseInt(document.getElementById('kids').value) || 0;
            const personsCount = parseInt(document.getElementById('persons').value) || 1;
            
            if (rnt > 0) {
                const btn = calcForm.querySelector('button[type="submit"]');
                const originalText = btn.innerText;
                btn.innerText = "Analysiere...";
                btn.disabled = true;

                try {
                    // 1. Payload für Python Backend bauen
                    const members = [];
                    members.push({ role: "main", age: 35, incomes: [{ amount_net: inc, amount_brutto: inc * 1.4 }] });
                    if (personsCount > 1 && (personsCount - kidsCount) > 1) {
                        members.push({ role: "partner", age: 35, incomes: [] });
                    }
                    for(let i=0; i<kidsCount; i++) {
                        members.push({ role: "child", age: 10, incomes: [] });
                    }

                    const payload = {
                        rent_cold: rnt,
                        rent_utility: 0,
                        rent_heating: 0,
                        termination_reason: "none",
                        members: members
                    };

                    // 2. API Abfrage
                    const apiUrl = window.location.hostname.includes('localhost') 
                        ? 'http://localhost:8000/api/v4/analyze' 
                        : 'https://sozialer-navigator-api.onrender.com/api/v4/analyze';

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error('Server Fehler');
                    const data = await response.json();

                    // 3. Ergebnisse anzeigen
                    showView('results');
                    
                    const resAmount = document.getElementById('res-amount');
                    const resText = document.querySelector('#view-results .max-w-2xl p');
                    const cityName = cityInput.value || "Ihrer Stadt";
                    const ratioText = document.getElementById('ratio-text');
                    const nextStepsContainer = document.getElementById('next-steps-result');
                    const cityObj = CITY_DB.find(c => c.name === cityName);
                    
                    document.getElementById('res-date').innerText = new Date().toLocaleDateString('de-DE', { month: 'long', year: 'numeric' });

                    // 3. Ergebnisse verarbeiten
                    const sgb2 = data.results.find(r => r.type === 'SGB2');
                    const wogg = data.results.find(r => r.type === 'WOHNGELD');
                    
                    let finalAmount = 0;
                    let resultType = "Kein Anspruch";
                    let isSGB2 = false;

                    if (sgb2 && sgb2.amount > 0) {
                        finalAmount = sgb2.amount;
                        resultType = "Bürgergeld";
                        isSGB2 = true;
                    } else if (wogg && wogg.amount > 0) {
                        finalAmount = wogg.amount;
                        resultType = "Wohngeld";
                    }

                    // UI Updates
                    if (isSGB2) {
                        resAmount.innerText = "Bürgergeld";
                        resAmount.classList.remove('text-[7rem]', 'md:text-[10rem]');
                        resAmount.classList.add('text-[4rem]', 'md:text-[6rem]');
                        resText.innerHTML = `Basierend auf Ihrer Situation haben Sie voraussichtlich Anspruch auf <strong class="text-brand-blue">Bürgergeld</strong> in Höhe von ca. <strong>${finalAmount.toFixed(0)}€</strong>.`;
                    } else {
                        resAmount.innerText = finalAmount > 0 ? `${finalAmount.toFixed(0)}€` : "0€";
                        resAmount.classList.add('text-[7rem]', 'md:text-[10rem]');
                        resAmount.classList.remove('text-[4rem]', 'md:text-[6rem]');
                        resText.innerHTML = `Basierend auf der <span class="text-brand-blue">Mietstufe ${ms}</span> in <span class="text-brand-blue font-black underline">${cityName}</span> besteht ein positiver Anspruch auf <strong>${resultType}</strong>.`;
                    }

                    const ratio = Math.min(100, Math.round((rnt / (inc + finalAmount || 1)) * 100));
                    if(ratioText) ratioText.innerText = `${ratio}%`;
                    updateChart(ratio);

                    // Fahrplan anzeigen (vereinfacht für Index)
                    let authorityInfo = '';
                    if (cityObj && cityObj.amt_name && !isSGB2) {
                        authorityInfo = `<div class="mt-4 p-4 bg-slate-50 rounded-xl border border-slate-100"><p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Zuständige Stelle</p><p class="font-bold text-brand-slate">${cityObj.amt_name}</p><p class="text-xs text-slate-500">${cityObj.amt_adresse}</p></div>`;
                    }

                    nextStepsContainer.innerHTML = `
                        <h5 class="font-bold text-brand-slate text-sm uppercase tracking-wider mb-3">Ihr Fahrplan: ${resultType}</h5>
                        <ul class="space-y-3 text-sm text-slate-600 font-medium">
                            <li class="flex gap-3"><div class="w-6 h-6 rounded-full bg-blue-100 text-brand-blue flex items-center justify-center shrink-0 font-bold text-xs">1</div><span><strong>Antrag stellen:</strong> Wenden Sie sich an die zuständige Behörde.</span></li>
                        </ul>
                        ${authorityInfo}
                    `;

                } catch (err) {
                    console.error(err);
                    alert("Verbindungsfehler: Stellen Sie sicher, dass das Backend läuft.");
                } finally {
                    btn.innerText = originalText;
                    btn.disabled = false;
                }

                // --- MIET-CHECK LOGIK ---
                const rentLimit = (RENT_LIMITS[ms] && RENT_LIMITS[ms][Math.min(kidsCount + (document.getElementById('persons').value - kidsCount) - 1, 4)]) || 500;
                const isOverLimit = rnt > rentLimit;
                const rentCheckContainer = document.getElementById('rent-check-result');
                
                rentCheckContainer.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${isOverLimit ? 'bg-orange-100 text-orange-600' : 'bg-green-100 text-green-600'}">
                            <i data-lucide="${isOverLimit ? 'alert-triangle' : 'check-circle-2'}" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h5 class="font-bold text-brand-slate text-sm uppercase tracking-wider mb-1">Miet-Check (Stufe ${ms})</h5>
                            <p class="text-sm text-slate-600 font-medium leading-relaxed">
                                ${isOverLimit ? `Ihre Miete liegt <strong>über dem Richtwert</strong> von ${rentLimit}€. Es wird nur der Höchstbetrag für die Berechnung berücksichtigt.` : `Ihre Miete liegt <strong>vollständig im Rahmen</strong> (Limit: ${rentLimit}€). Die Kosten werden voll anerkannt.`}
                            </p>
                        </div>
                    </div>
                `;

                // --- LEADS MONETARISIERUNG ---
                const leadsContainer = document.getElementById('result-leads');
                let leads = [];

                // 0. Bürgergeld Lead (bei 0 Einkommen)
                if (inc === 0) {
                     leads.push({ 
                        icon: 'briefcase', 
                        title: 'Bürgergeld beantragen', 
                        desc: 'Sichern Sie Ihren Lebensunterhalt. Hier finden Sie alle Infos zum Antrag beim Jobcenter.', 
                        link: 'https://www.arbeitsagentur.de/arbeitslos-arbeit-finden/buergergeld', 
                        cta: 'Zum Antrag', 
                        recommended: true 
                    });
                }

                // 1. Kinder-Zuschuss (KiZ) - Nur sinnvoll wenn Einkommen > 0
                if (kidsCount > 0 && inc > 0) {
                    leads.push({ 
                        icon: 'baby', 
                        title: 'Kinder-Zuschuss (KiZ)', 
                        desc: 'Zusätzlich zum Wohngeld stehen Ihnen bis zu 292€ pro Kind zu. Prüfen Sie jetzt Ihren Anspruch.', 
                        link: 'https://www.arbeitsagentur.de/familie-und-kinder/kinderzuschlag-anspruch-hoehe-dauer', 
                        cta: 'Anspruch prüfen', 
                        recommended: true 
                    });
                }

                // 2. Karriere-Boost (AVGS)
                leads.push({ 
                    icon: 'graduation-cap', 
                    title: '🎓 Karriere-Boost (AVGS)', 
                    desc: 'Wir prüfen Ihren Anspruch auf 100% geförderte Coachings im Wert von 2.500€ – staatlich finanziert über den AVGS-Gutschein.', 
                    link: '#lead-generation-form', 
                    cta: 'Kostenlos prüfen', 
                    recommended: true,
                    preselect: 'avgs'
                });

                // 3. Hilfe bei Ablehnung
                leads.push({ 
                    icon: 'file-warning', 
                    title: 'Hilfe bei Ablehnung', 
                    desc: 'Antrag abgelehnt oder falsch berechnet? Wir prüfen Ihren Bescheid kostenlos und legen Widerspruch ein.', 
                    link: '#lead-generation-form', 
                    cta: 'Bescheid prüfen', 
                    recommended: false,
                    preselect: 'ablehnung'
                });

                leadsContainer.innerHTML = leads.map(lead => `
                    <a href="${lead.link}" ${lead.link.startsWith('#') ? `onclick="openLeadForm('${lead.preselect}'); return false;"` : 'target="_blank" rel="noopener noreferrer"'} class="group relative p-6 bg-white border ${lead.recommended ? 'border-brand-blue ring-1 ring-brand-blue shadow-lg' : 'border-slate-200'} rounded-2xl hover:border-brand-blue/30 hover:shadow-xl hover:-translate-y-1 transition-all text-left flex flex-col justify-between h-full">
                        ${lead.recommended ? '<div class="absolute -top-3 left-6 bg-brand-blue text-white text-[10px] font-bold uppercase tracking-widest px-3 py-1 rounded-full shadow-md">Empfohlen</div>' : ''}
                        <div class="space-y-4">
                            <div class="w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center text-brand-blue group-hover:scale-110 transition-transform">
                                <i data-lucide="${lead.icon}" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h5 class="font-bold text-brand-slate text-lg">${lead.title}</h5>
                                <p class="text-sm text-slate-500 mt-2 leading-relaxed">${lead.desc}</p>
                            </div>
                        </div>
                        <div class="mt-6 flex items-center text-xs font-bold uppercase tracking-widest text-brand-blue group-hover:gap-2 transition-all">
                            ${lead.cta} <i data-lucide="arrow-right" class="w-3 h-3 ml-1"></i>
                        </div>
                    </a>
                `).join('');
                lucide.createIcons();
                
                // Formular anzeigen
                document.getElementById('lead-generation-form').classList.remove('hidden');
            }
        });

        function updateChart(val) {
            const ctx = document.getElementById('ratioChart').getContext('2d');
            if (ratioChartInstance) ratioChartInstance.destroy();
            ratioChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: { datasets: [{ data: [val, 100 - val], backgroundColor: ['#2563eb', '#f1f5f9'], borderWidth: 0, borderRadius: 15 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '80%', plugins: { legend: { display: false }, tooltip: { enabled: false } } }
            });
        }

        window.scrollToId = (id) => {
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: 'smooth' });
        };
    </script>
</body>
</html>