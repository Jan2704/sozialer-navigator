---
// index.astro - Sozialer Navigator 2026 - Calm Authority Edition
import { wohngeldData } from '../data/wohngeldData.js';
import { SmartCalculator } from '../components/SmartCalculator.jsx';
import ResultsSection from '../components/ResultsSection.astro';
import SchemaOrg from '../components/SEO/SeoSchema.astro';
import Layout from '../layouts/Layout.astro';

import '../styles/global.css';

const description = "Rechtlich fundierte Anspruchsprüfung für Wohngeld & Bürgergeld 2026. Anonym. Kostenlos. Ohne Registrierung.";
---

<Layout 
    title="Wohngeld & Bürgergeld 2026: Anspruch online prüfen | Sozialer Navigator"
    description={description}
    hideNav={false}
    class="bg-bg-base text-text-primary"
>

    <!-- SEO Meta & Schema -->
    <fragment slot="head">
        <meta property="og:type" content="website" />
        <meta property="og:title" content="Sozialer Navigator | Rechtliche Anspruchsprüfung 2026" />
        <meta property="og:description" content={description} />
        <meta property="og:image" content="/apple-touch-icon.png" />
        <meta property="og:url" content="https://sozialer-navigator.de/" />

        <SchemaOrg type="Organization" />
        <SchemaOrg type="Website" />
        <SchemaOrg type="SoftwareApplication" />
        
        <script is:inline src="/scripts/lucide.min.js"></script>
        
        <script>
            import { gsap } from 'gsap';
            import { ScrollTrigger } from 'gsap/ScrollTrigger';
            import Chart from 'chart.js/auto';

            gsap.registerPlugin(ScrollTrigger);

            window.Chart = Chart;
            window.gsap = gsap;
            window.ScrollTrigger = ScrollTrigger;

            if (window.lucide) {
                window.lucide.createIcons();
            }
            
            document.addEventListener('astro:page-load', () => {
                if (window.lucide) window.lucide.createIcons();
            });
        </script>
        
        <style>
            /* View Transitions */
            .view-section { display: none; opacity: 0; transition: opacity 0.4s ease-in-out; }
            .view-section.active { display: block; opacity: 1; }
        </style>
    </fragment>

    <main class="min-h-screen relative pt-0 pb-32 text-slate-100">

        <!-- Global Fixed Background -->
        <div class="fixed inset-0 z-0 select-none pointer-events-none">
             <img src="/images/hero-navigator.png" alt="Sozialer Navigator Hintergrund" class="w-full h-full object-cover object-right-bottom" />
             <!-- Global Overlay for readability -->
             <div class="absolute inset-0 bg-gradient-to-r from-[#0F172A] via-[#0F172A]/80 to-transparent"></div>
        </div>
        
        <!-- VIEW 1: HOME -->
        <section id="view-home" class="view-section active w-full relative z-10">
             
            <!-- HERO CLUSTER -->
            <div class="relative w-full h-[800px] overflow-hidden animate-slide-up">

                <!-- Content -->
                <div class="relative z-10 h-full max-w-5xl mx-auto px-6 flex flex-col justify-center energy-line"> 
                    
                    <div class="max-w-2xl pt-20">
                        <!-- Status Badge -->

                        
                        <!-- Main Typography -->
                        <h1 class="font-bold tracking-tight mb-6 text-white text-5xl lg:text-7xl leading-[1.1]">
                            Wir prüfen deinen Rechtsanspruch auf <br />
                            <span class="text-blue-200">Wohngeld & Bürgergeld.</span>
                        </h1>
                        
                        <p class="text-xl text-slate-300 leading-relaxed mb-10 text-balance max-w-lg">
                           Für Mieter und Eigentümer. Wir beenden sofort das Rätselraten, ob dir staatliche Unterstützung zusteht.
                        </p>

                             <a href="#calculator" class="calm-btn-primary shadow-lg shadow-blue-500/20 text-lg px-8 py-4">
                                Jetzt Anspruch prüfen
                             </a>
                        </div>

                    </div>
                </div>
            </div>

            <!-- HOW IT WORKS CLUSTER -->
            <div class="max-w-6xl mx-auto px-6 grid md:grid-cols-3 gap-6 text-left mb-32 relative z-20 -mt-16">
                 <div class="calm-card p-8 bg-[#1e293b]/50 backdrop-blur-xl border border-white/10 hover:bg-[#1e293b]/70 transition-colors">
                     <div class="w-10 h-10 flex items-center justify-center rounded-lg bg-blue-500/20 text-blue-300 font-bold mb-6 border border-blue-500/30">1</div>
                     <h3 class="font-bold text-white mb-3">Daten eingeben</h3>
                     <p class="text-sm text-slate-400 leading-relaxed">Erfasse dein Haushaltseinkommen und deine Wohnkosten. Alle Angaben sind freiwillig.</p>
                 </div>

                 <div class="calm-card p-8 bg-[#1e293b]/50 backdrop-blur-xl border border-white/10 hover:bg-[#1e293b]/70 transition-colors">
                     <div class="w-10 h-10 flex items-center justify-center rounded-lg bg-blue-500/20 text-blue-300 font-bold mb-6 border border-blue-500/30">2</div>
                     <h3 class="font-bold text-white mb-3">Rechtliche Prüfung</h3>
                     <p class="text-sm text-slate-400 leading-relaxed">Unser System gleicht deine Daten mit den aktuellen Tabellen für Wohngeld und Bürgergeld ab.</p>
                 </div>

                 <div class="calm-card p-8 bg-[#1e293b]/50 backdrop-blur-xl border border-white/10 hover:bg-[#1e293b]/70 transition-colors">
                     <div class="w-10 h-10 flex items-center justify-center rounded-lg bg-blue-500/20 text-blue-300 font-bold mb-6 border border-blue-500/30">3</div>
                     <h3 class="font-bold text-white mb-3">Ergebnis & Antrag</h3>
                     <p class="text-sm text-slate-400 leading-relaxed">Du erhältst eine sofortige Einschätzung und Zugang zu den offiziellen Antragsformularen.</p>
                 </div>
            </div>

            <!-- CALCULATOR SECTION (Pause before) -->
            <div id="calculator" class="max-w-5xl mx-auto px-6 mb-32 scroll-mt-32 animate-slide-up delay-200 energy-line"> <!-- Gesture on Calculator too -->
                <div class="calm-card p-0 overflow-hidden relative shadow-md bg-[#1e293b] border border-white/10">
                    
                    <!-- Header -->
                    <div class="px-8 py-6 calm-divider bg-white/5 flex justify-between items-center">
                         <div>
                             <h2 class="text-lg font-bold text-white">Anspruchsprüfung</h2>
                         </div>
                         <div class="text-xs text-slate-400 font-medium flex items-center gap-2">
                             <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                             Privat & Anonym
                         </div>
                    </div>
                    
                    <!-- Calculator Component Wrapper -->
                    <div class="p-6 md:p-12 bg-[#1e293b]">
                        <SmartCalculator client:load theme="dark" />
                    </div>
                    
                    <!-- Footer Info -->
                    <div class="px-8 py-5 bg-[#0F172A]/50 calm-divider text-center">
                        <p class="text-xs text-slate-400">
                            Deine Eingaben werden nur lokal in deinem Browser verarbeitet. <br/>
                            Es erfolgt keine Speicherung auf unseren Servern.
                        </p>
                    </div>
                </div>
            </div>



        </section>

        <!-- VIEW: RESULTS (via Component) -->
        <ResultsSection />

    </main>

    <!-- NOTIFICATION -->
    <div id="notification-toast" class="bg-[#1e293b] text-white px-6 py-4 rounded-xl shadow-lg border border-white/10 flex items-center gap-4 fixed bottom-6 left-1/2 -translate-x-1/2 z-[300] hidden transform translate-y-4 opacity-0 transition-all">
        <i data-lucide="check-circle" class="text-emerald-400"></i>
        <span id="toast-message" class="font-medium text-sm">Status aktualisiert.</span>
    </div>

    <!-- COOKIE BANNER (Dark) -->
    <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-[#0F172A]/95 backdrop-blur-xl border-t border-white/10 p-6 z-50 hidden flex-col md:flex-row items-center justify-between gap-6 shadow-2xl transform translate-y-full transition-transform duration-500">
        <div class="text-sm text-slate-300 font-medium max-w-2xl">
            <p><strong>Datenschutz-Hinweis:</strong> Wir nutzen Cookies für die technische Funktionalität. Es werden keine persönlichen Daten ohne Ihre explizite Handlung gespeichert.</p>
        </div>
        <div class="flex gap-4 shrink-0">
            <button onclick="acceptCookies()" class="bg-white text-[#0F172A] px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-widest hover:bg-slate-200 transition-colors">
                Akzeptieren
            </button>
            <button onclick="declineCookies()" class="text-slate-400 hover:text-white text-xs font-bold uppercase tracking-widest transition-colors px-4 py-2.5">
                Nur Essenzielle
            </button>
        </div>
    </div>

    <script is:inline define:vars={{ cityData: wohngeldData }}>
        window.cityData = cityData;
    </script>
    
    <script>
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    // View Switching Logic (Consolidated)
    if (!window.showView) {
        window.showView = (viewId) => {
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.remove('active');
                setTimeout(() => el.style.display = 'none', 400);
            });
            const target = document.getElementById('view-' + viewId);
            if(target) {
                target.style.display = 'block';
                // Force reflow
                void target.offsetWidth;
                target.classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };
    }

    if (!window.goBack) {
        window.goBack = () => {
             window.showView('home');
        };
    }
    
    // Cookie Logic
    window.acceptCookies = () => {
        localStorage.setItem('cookieConsent', 'granted');
        const banner = document.getElementById('cookie-banner');
        if(banner) banner.classList.add('hidden');
    };

    window.declineCookies = () => {
        localStorage.setItem('cookieConsent', 'denied');
        const banner = document.getElementById('cookie-banner');
        if(banner) banner.classList.add('hidden');
    };

    document.addEventListener('DOMContentLoaded', () => {
        const consent = localStorage.getItem('cookieConsent');
        if (consent === null) {
            const banner = document.getElementById('cookie-banner');
            if(banner) {
                banner.classList.remove('hidden');
                requestAnimationFrame(() => banner.classList.remove('translate-y-full'));
            }
        }
    });
    </script>

</Layout>