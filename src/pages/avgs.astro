---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Wartezeit-Hilfe | AVGS Coaching Check" description="Prüfe deinen Anspruch auf ein kostenloses 1:1 Coaching während der Wohngeld-Wartezeit.">
  
  <main class="min-h-screen bg-[#F8FAFC] text-slate-900 flex items-center justify-center p-6 pt-32 relative overflow-hidden">
    
    <!-- Background Elements -->
    <div class="absolute inset-0 bg-[url('/grid-pattern.svg')] opacity-5 pointer-events-none"></div>
    <div class="absolute top-[-20%] right-[-10%] w-[800px] h-[800px] bg-blue-500/5 blur-[100px] rounded-full pointer-events-none"></div>

    <div class="max-w-2xl w-full relative z-10 text-center">
      
      <div class="inline-block bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest mb-6 border border-blue-100 shadow-sm">
         Wartezeit-Hilfe
      </div>
      
      <h1 class="text-4xl md:text-5xl font-black text-slate-900 mb-6 tracking-tight leading-tight">
        Wartezeit sinnvoll nutzen.
      </h1>
      
      <p class="text-lg text-slate-600 font-medium mb-12 max-w-xl mx-auto leading-relaxed">
        Die Bearbeitung deines Antrags dauert Monate. Nutze diese Zeit für ein 100% gefördertes 1:1 Coaching (AVGS) im Wert von 2.500 €.
      </p>

      <div id="form-wrapper" class="bg-white border border-slate-200 p-8 md:p-10 rounded-3xl shadow-xl relative overflow-hidden text-left">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-indigo-500"></div>
        
        <h3 class="text-xl font-bold text-slate-900 mb-6">Unverbindliche Prüfung anfordern</h3>
        
        <form id="avgs-lead-form" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <input type="text" id="v-name" placeholder="Vorname" required class="w-full bg-slate-50 border border-slate-200 rounded-xl px-5 py-4 text-slate-900 placeholder:text-slate-400 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all font-medium" />
            <input type="text" id="n-name" placeholder="Nachname" required class="w-full bg-slate-50 border border-slate-200 rounded-xl px-5 py-4 text-slate-900 placeholder:text-slate-400 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all font-medium" />
          </div>
          <input type="email" id="e-mail" placeholder="E-Mail Adresse" required class="w-full bg-slate-50 border border-slate-200 rounded-xl px-5 py-4 text-slate-900 placeholder:text-slate-400 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all font-medium" />
          <input type="tel" id="tel" placeholder="Telefonnummer (optional)" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-5 py-4 text-slate-900 placeholder:text-slate-400 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all font-medium" />
          
          <button type="submit" id="submit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold uppercase tracking-widest py-4 rounded-xl mt-4 shadow-lg shadow-blue-500/20 transition-all transform hover:-translate-y-0.5">
            Jetzt Anspruch prüfen
          </button>
        </form>

        <div id="success-message" class="hidden text-center py-8">
          <div class="text-6xl mb-4">✅</div>
          <h3 class="text-2xl font-black text-emerald-600 mb-2">Anfrage gesendet!</h3>
          <p class="text-slate-500 mb-8">Wir prüfen deine Daten und melden uns in Kürze bei dir.</p>
          <a href="/" class="text-blue-600 font-bold hover:text-blue-700 transition-colors">← Zurück zum Navigator</a>
        </div>
      </div>

    </div>
  </main>
</Layout>

<script>
  import { createClient } from '@supabase/supabase-js'
  const supabase = createClient('https://iiimjuplyjqapvwhbozf.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlpaW1qdXBseWpxYXB2d2hib3pmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NTI4MTgsImV4cCI6MjA4MTIyODgxOH0.Ru-09I4PuFQsJC-AMcdntn9bCS2f9lOdGQoMo7fAHYs')

  const form = document.getElementById('avgs-lead-form');
  const btn = document.getElementById('submit-btn');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    if(btn) {
        btn.innerText = 'Wird gesendet...';
        btn.disabled = true;
    }

    const { error } = await supabase.from('leads').insert([{ 
      vorname: document.getElementById('v-name').value, 
      nachname: document.getElementById('n-name').value,
      email: document.getElementById('e-mail').value,
      phone: document.getElementById('tel').value,
      typ: 'avgs',
      status: 'neu'
    }]);

    if (!error) {
      form.style.display = 'none';
      const successMsg = document.getElementById('success-message');
      if(successMsg) successMsg.style.display = 'block';
    } else {
      alert('Fehler beim Senden. Bitte versuche es später erneut.');
      if(btn) {
          btn.innerText = 'Jetzt Anspruch prüfen';
          btn.disabled = false;
      }
    }
  });
</script>