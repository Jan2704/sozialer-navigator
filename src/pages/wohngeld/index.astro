---
import Layout from '../../layouts/Layout.astro';
import { wohngeldData } from '../../data/wohngeldData.js';

const cities = wohngeldData.sort((a, b) => a.stadt.localeCompare(b.stadt));
const description = "Finden Sie Ihre zuständige Wohngeldstelle und prüfen Sie Ihren Anspruch. Alle Städte, Mietstufen und Kontaktinformationen.";
---

<Layout title="Wohngeldstelle finden | Sozialer Navigator" description={description}>
    
    <main class="min-h-screen bg-[#0F172A] text-slate-100 pt-32 pb-24 px-6 relative overflow-hidden">
        
        <!-- Background Elements -->
        <div class="fixed inset-0 z-0 select-none">
            <img src="/images/hero-navigator.png" alt="" class="w-full h-full object-cover object-right-bottom opacity-30 ml-auto" />
             <!-- Gradient Overlay: Seamless blend to dark bg -->
            <div class="absolute inset-0 bg-gradient-to-r from-[#0F172A] via-[#0F172A]/90 to-transparent"></div>
            <div class="absolute inset-0 bg-gradient-to-t from-[#0F172A] via-transparent to-transparent"></div>
        </div>

        <div class="max-w-5xl mx-auto relative z-10">
            
            <div class="text-center mb-16">
                 <div class="inline-flex items-center gap-2 bg-white/5 backdrop-blur-md border border-white/10 shadow-sm rounded-full px-4 py-1.5 mb-6">
                    <span class="w-1.5 h-1.5 rounded-full bg-blue-400"></span>
                    <span class="text-xs font-bold uppercase tracking-widest text-blue-100">Stadtfinder 2026</span>
                </div>
                <h1 class="font-bold tracking-tight text-white text-4xl md:text-5xl mb-6">
                    Wohngeldstelle finden.
                </h1>
                <p class="text-lg text-slate-400 max-w-2xl mx-auto leading-relaxed">
                    Suchen Sie nach Ihrer Stadt, um die zuständige Wohngeldstelle, Mietstufen und spezifische Informationen zu erhalten.
                </p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                
                <!-- Search Widget (Span 2) -->
                <div class="lg:col-span-2 relative group">
                     <!-- Card Background -->
                     <div class="absolute inset-0 bg-[#1e293b]/50 backdrop-blur-xl border border-white/10 rounded-2xl -z-10 transition-colors group-hover:bg-[#1e293b]/70"></div>
                     
                     <div class="p-8 md:p-10">
                         <div class="relative z-10">
                             <div class="relative max-w-xl mx-auto lg:mx-0">
                                  <div class="relative z-20 group-focus-within:scale-[1.02] transition-transform duration-300">
                                      <!-- Input Glow Effect -->
                                      <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-500 opacity-0 group-focus-within:opacity-50 blur transition duration-500 rounded-xl"></div>
                                      
                                      <input 
                                          type="text" 
                                          id="hub-search" 
                                          placeholder="Welche Stadt suchen Sie?" 
                                          class="relative w-full bg-[#0F172A] border border-white/10 text-white placeholder:text-slate-500 rounded-xl px-5 py-4 font-medium text-lg outline-none focus:ring-1 focus:ring-blue-400/50 focus:border-blue-400/50 transition-all shadow-xl"
                                          autocomplete="off"
                                      >
                                      
                                      <div class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                      </div>
                                  </div>
                                  
                                  <!-- Dropdown Results -->
                                  <div id="search-results" class="hidden absolute top-full left-0 right-0 mt-4 bg-[#1e293b] border border-white/10 rounded-xl shadow-2xl max-h-80 overflow-y-auto z-50 p-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent"></div>
                             </div>

                             <div class="mt-8 flex flex-wrap gap-3 items-center">
                                 <span class="text-xs font-bold uppercase tracking-wider text-slate-500 mr-2">Beliebt:</span>
                                 <a href="/wohngeld/berlin" class="text-xs bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 text-slate-300 px-4 py-2 rounded-lg font-medium transition-all">Berlin</a>
                                 <a href="/wohngeld/koeln" class="text-xs bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 text-slate-300 px-4 py-2 rounded-lg font-medium transition-all">Köln</a>
                                 <a href="/wohngeld/frankfurt" class="text-xs bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 text-slate-300 px-4 py-2 rounded-lg font-medium transition-all">Frankfurt</a>
                                 <a href="/wohngeld/muenchen" class="text-xs bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 text-slate-300 px-4 py-2 rounded-lg font-medium transition-all">München</a>
                             </div>
                         </div>
                     </div>
                </div>

                <!-- Info Widget (Span 1) -->
                <div class="bg-[#1e293b]/50 backdrop-blur-xl border border-white/10 rounded-2xl p-8 flex flex-col justify-between hover:bg-[#1e293b]/70 transition-colors">
                    <div>
                        <span class="text-xs font-bold uppercase tracking-wider text-blue-400 mb-3 block">Aktuell</span>
                        <h3 class="text-xl font-bold text-white mb-2">Wohngeld-Plus</h3>
                        <div class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-white mb-2 tracking-tight">Mehr Geld.</div>
                        <p class="text-slate-400 text-sm font-medium leading-relaxed">
                            Die Heizkostenkomponente und Klimakomponente erhöhen Ihren Anspruch deutlich.
                        </p>
                    </div>
                    
                    <div class="mt-10 pt-6 border-t border-white/5">
                        <a href="/leistungen/wohngeld-plus" class="flex items-center justify-between text-sm font-medium text-blue-400 hover:text-blue-300 transition-colors group">
                            Was ist neu?
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform group-hover:translate-x-1 transition-transform"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                        </a>
                    </div>
                </div>
            </div>

             <!-- Quick Stats / Additional Info -->
             <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
                  <div class="bg-[#1e293b]/30 backdrop-blur-sm border border-white/5 rounded-xl p-6 hover:bg-[#1e293b]/50 transition-colors">
                      <span class="inline-flex items-center justify-center w-8 h-8 rounded-lg bg-blue-500/10 text-blue-400 mb-4">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                      </span>
                      <h4 class="font-bold text-slate-200 text-base mb-2">Dauerhafte Heizkosten</h4>
                      <p class="text-sm text-slate-400 leading-relaxed">
                           Pauschale für Heizkosten ist nun fest in die Berechnung integriert.
                      </p>
                  </div>

                   <div class="bg-[#1e293b]/30 backdrop-blur-sm border border-white/5 rounded-xl p-6 hover:bg-[#1e293b]/50 transition-colors">
                      <span class="inline-flex items-center justify-center w-8 h-8 rounded-lg bg-emerald-500/10 text-emerald-400 mb-4">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                      </span>
                      <h4 class="font-bold text-slate-200 text-base mb-2">Mehr Berechtigte</h4>
                      <p class="text-sm text-slate-400 leading-relaxed">
                           Einkommensgrenzen wurden angehoben, mehr Haushalte sind berechtigt.
                      </p>
                  </div>

                  <div class="bg-[#1e293b]/30 backdrop-blur-sm border border-white/5 rounded-xl p-6 hover:bg-[#1e293b]/50 transition-colors">
                      <span class="inline-flex items-center justify-center w-8 h-8 rounded-lg bg-amber-500/10 text-amber-400 mb-4">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/><line x1="3.27" y1="6.96" x2="12" y2="12.01"/><line x1="20.73" y1="6.96" x2="12" y2="12.01"/></svg>
                      </span>
                      <h4 class="font-bold text-slate-200 text-base mb-2">Klimakomponente</h4>
                      <p class="text-sm text-slate-400 leading-relaxed">
                           Zuschlag für energetische Sanierung und klimafreundliches Wohnen.
                      </p>
                  </div>
             </div>
        </div>

        <script is:inline define:vars={{ cities }}>
            const searchInput = document.getElementById('hub-search');
            const resultsContainer = document.getElementById('search-results');

            if (searchInput && resultsContainer) {
                searchInput.addEventListener('input', (e) => {
                    const val = e.target.value.toLowerCase();
                    if (val.length < 2) {
                        resultsContainer.classList.add('hidden');
                        return;
                    }

                    const filtered = cities.filter(c => c.stadt.toLowerCase().includes(val)).slice(0, 8);
                    
                    if (filtered.length > 0) {
                        resultsContainer.innerHTML = filtered.map(c => `
                            <a href="/wohngeld/${c.slug}" class="block px-4 py-3 hover:bg-white/5 transition-colors flex justify-between items-center group rounded-lg mb-1">
                                <span class="text-sm font-medium text-slate-200 group-hover:text-white">${c.stadt}</span>
                                <span class="text-[10px] text-slate-500 group-hover:text-slate-400 uppercase tracking-wide border border-white/5 px-2 py-1 rounded">Mietstufe ${c.mietstufe}</span>
                            </a>
                        `).join('');
                        resultsContainer.classList.remove('hidden');
                    } else {
                        resultsContainer.innerHTML = `<div class="px-4 py-3 text-sm text-slate-500 italic">Keine Ergebnisse gefunden</div>`;
                        resultsContainer.classList.remove('hidden');
                    }
                });

                document.addEventListener('click', (e) => {
                    if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target)) {
                        resultsContainer.classList.add('hidden');
                    }
                });

                // Keyboard navigation for accessibility
                searchInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        resultsContainer.classList.add('hidden');
                        searchInput.blur();
                    }
                });
            }
        </script>
    </main>
</Layout>
